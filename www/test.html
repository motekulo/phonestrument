<html>
    <head>
        <title>Phonestrument</title>
        <script src="js/interface.js"></script>
        <script src="js/Tone.js"></script>
    </head>

    <body>

        <div id='Content'>

        </div>
        <script>

var drumpitches =  ["C2","D3","E4","F2"];
var timestring = "";

var synth = new Array(4);
var note = new Array(4);
//var row = new Array(16);


for (i = 0; i < 4; i++){
    synth[i] = new Tone.DrumSynth().toMaster();
}


for (j = 0; j < 4; j++) {

    note[j] = [,,,,,,,,,,,,,,,];
    for (i = 0; i < 16; i++) {

        /* Weird switch construct, because simply passing in j as the index to
           the array in the callback fails. So this doesn't work (because j is
           undefined when called back I guess?).:

           note[j][i] = new Tone.Event(function(time, pitch){
           synth[j].triggerAttackRelease(pitch, "16n", time);
           }, drumpitches[j]);

        // have tried j.valueOf() as well to no avail

         */

        switch(j) {
            case 0: {
                note[j][i] = new Tone.Event(function(time, pitch){
                    synth[0].triggerAttackRelease(pitch, "16n", time);
                }, drumpitches[0]);
                break;
            }
            case 1: {
                note[j][i] = new Tone.Event(function(time, pitch){
                    synth[1].triggerAttackRelease(pitch, "16n", time);
                }, drumpitches[1]);
                break;
            }
            case 2: {
                note[j][i] = new Tone.Event(function(time, pitch){
                    synth[2].triggerAttackRelease(pitch, "16n", time);
                }, drumpitches[2]);
                break;
            }
            case 3: {
                note[j][i] = new Tone.Event(function(time, pitch){
                    synth[3].triggerAttackRelease(pitch, "16n", time);
                }, drumpitches[3]);
                break;
            }
        }

        note[j][i].set({
            "loop" : true,
            "loopEnd" : "1m"
        });

    }
}

// Interface section

var b = new Interface.Button({ 
    bounds:[.05,.05,.1,.1],  
    label:'On/Off',
    onvaluechange : function() {
        console.log("Value: " + this.value)
        if (this.value == 1) {
            Tone.Transport.start();
        } else {
            Tone.Transport.stop();
        }
    }

});


var a = new Interface.Panel();
var multiButton = new Interface.MultiButton({
    rows:4, columns:16,
    bounds:[.2,.05,.7,.8],
    onvaluechange : function(row, col, value) {
        console.log( 'row : ' + row + ' , col : ' + col + ' , value : ' + value);
        timestring = "0:0:" + col;
        console.log("timestring: " + timestring);
        if (value == 1) {
            note[row][col].start(timestring);
        } else {
            note[row][col].stop();
        }

    },
});

a.background = 'black';

var s1 = new Interface.Slider({
    target: synth[0],
    key: 'octaves',
    min: 0,
    max: 20,
    label: '8ves',
    bounds: [0.9, 0.05, 0.1, 0.2],
    onvaluechange : function() {
        synth[0].octaves.value = this.value;
        console.log("this.value " + this.value);
    }
});

a.add(b, multiButton, s1);

//for(var i = 0; i < multiButton.count; i++) {
//    multiButton._values[i] = Math.random() > .5 ;
//}
//

        </script>
    </body>
</html>

